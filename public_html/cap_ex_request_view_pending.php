<html>
  <head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Valparaiso University Student Senate Home</title>
   <link rel="icon" href="ValpoIcon.png" type="image/ico" sizes="5x5">
		<style type="text/css">
			html, #page { padding:0; margin:0;}
			body {
        margin:0; 
        padding:0; 
        width:100%; 
        color:#381e0e; 
        font:normal 12px/2.0em Arial;
      } 
			h1{
        color:black; 
        text-decoration: underline;
        font:bold 15px/2.0em Arial;
      }
      h2{
        color:black; 
        
        font:normal 13px/2.0em Arial;
      }
      a.button {
        -webkit-appearance: button;
        -moz-appearance: button;
        appearance: button; 
        padding:3;
        padding-left:7;
        padding-right:8;
        font-size: 10pt;
        text-align:center;
        text-decoration: none;
        color: initial;
      }
      h3, h4, h5, h6 {color:381e0e;}
			#page { background:#fff;}
			#header, #footer, #top-nav, #content, #content #contentbar, #content #sidebar { margin:0; padding:0;}
				.data{
          text-align: center;
          padding-top: 5%;
          padding-left: 25%;
          padding-right: 25%;
          padding-bottom: 5%;
        }		
                        
       .triplecolumn {
      float: left;
      width: 33.33%;
      }
    .row:after {
      content: "";
      display: table;
      clear: both;
      }
        .links{
          text-align: center;
        }
        .links ul li a{
           color:#381e0e; 
           text-decoration:none;        
        }
        .links ul li a:hover{
          color:#f9ebdb; 
          font-weight:bold; 
          text-decoration:none;
        }
        .links ul{
          list-style: none;
          padding-left: 0;
        }
		    table{
        margin: 8px;
        }
        th{
        font-family: Arial, Helvetica, sans-serif;
        font-size: .7em;
        background: #381e0e;
        color: white;
        padding: 2px 6px;
        border-collapse: separate;
        border: 1px solid #000;
        }
        td{
        font-family: Arial, Helvetica, sans-serif;
        font-size: .7em;
        border: 1px solid #DDD;
        }
                        
			/* Logo */
			#logo { 
        text-decoration: bold;
        font:normal 20px/0.5em Arial;
        padding-top: 15px;
        padding-bottom: 15px;
        color: white;
        clear: left;
        background: #381e0e;
        text-align: center;
      }
			#logo h1 a, h1 a:hover { color:white; text-decoration:none;}

			/* Header */
			#header { background:#381e0e; width: 100%; }
			#header-inner{ margin: auto; padding:0; background:#381e0e; width:970px;}
			
			/* Feature */
			.featurei {background:orange; padding:0; width: 100%; float:left;}
			.feature-inner {margin: auto; width: auto;}
			.feature-inner h1 {padding-left: 160px; padding-right: 160px; color:#f9ebdb; font-size:32px;}
      .feature-inner h1 a{color:#f9ebdb; font-size:32px; text-decoration: none;}
      .feature-inner h1 a:hover{color: red; font-size:32px; text-decoration: none;}
			
			/* Menu */
			#top-nav {background: #e3dac8; width: 100%; margin:0 auto; padding:0px 5px 20px; height:50px; float:right;}
			#top-nav ul { list-style:none; padding-bottom: 0; height:40px; float:left;}
			#top-nav ul li { margin:0; padding:0 0 0 10px; float:left;}
			#top-nav ul li a { display:block; margin:0; padding:8px 20px; color:#381e0e; text-decoration:none;}
			#top-nav ul li.active a, #top-nav ul li a:hover { color:#f9ebdb; font-weight: bold;}
			
      .left{
        float: left;
      }
      .right{
        float: right;
      }
      
			/* Content */
			#content-inner { margin:0 auto; padding:10px 0; width:970px; background:#fff;}
			#content #contentbar { margin:0; padding:0; float:right; width:500px;}
			#content #contentbar .article { margin:0 50px 24px; padding:0 20px 0 15px; }
			#content #sidebar { padding:0; float:left; width:200px;}
			#content #sidebar .widget { margin:0 0 12px; padding:8px 8px 8px 13px;line-height:1.4em;}
			#content #sidebar .widget h3 a { text-decoration:none;}
			#content #sidebar .widget ul { margin:0; padding:0; list-style:none; color:#959595;}
			#content #sidebar .widget ul li { margin:0;}
			#content #sidebar .widget ul li { padding:4px 0; width:250px;}
			#content #sidebar .widget ul li a { color:#381e0e; text-decoration:none; margin-left:-16px; padding:4px 8px 4px 16px;}
			#content #sidebar .widget ul li a:hover { color:#f9ebdb; font-weight:bold; text-decoration:none;}
      
			#content #sidebarright { padding:0; float:right; width:200px;}
			#content #sidebarright .widget { margin:0 0 12px; padding:8px 8px 8px 13px;line-height:1.4em;}
			#content #sidebarright .widget h3 a { text-decoration:none;}
			#content #sidebarright .widget ul { margin:0; padding:0; list-style:none; color:#959595;}
			#content #sidebarright .widget ul li { margin:0;}
			#content #sidebarright .widget ul li { padding:4px 0; width:250px;}
			#content #sidebarright .widget ul li a { color:#381e0e; text-decoration:none; margin-left:-16px; padding:4px 8px 4px 16px;}
			#content #sidebarright .widget ul li a:hover { color:#f9ebdb; font-weight:bold; text-decoration:none;}
			
			/* Footer */
			#footer { background:#381e0e; text-align: center; bottom: 0; position: fixed; width: 100%;}
			#footer-inner {margin:auto; text-align:center; padding:12px; width:922px; color: white;}
			#footer a {color: white;text-decoration:none;}
      #footer a:hover{color: #e3dac8; text-decoration:bold;}
      
			
			/* Clear both sides to assist with div alignment  */
			.clr { clear:both; padding:0; margin:0; width:100%; font-size:0px; line-height:0px;}
		</style>
   
    
   
	</head>
  <body> 
  <div id="page">
			<header id="header">
				<div id="header-inner">	
					<div id="logo">
						<a href="admin.php">
              <img href="admin" src="ValpoLogo" alt="Valparaiso University Logo" style="width:425px;height:65px;">
            </a>
            <p>Pending Capital Expenditure Proposal Form ID: 
            <?php 
            $key = $_GET['key']; 
            echo $key 
            ?>
            </p>
					</div>
         </div>
				</div>
		  </header>   
			</div>
    </div>  
  </body>
  <footer id="footer">
	<div id="footer-inner">
    <p>&copy; Valparaiso University 2018, Valparaiso, IN 46383-6493, 219.464.5000 &#124; <a href="https://www.valpo.edu/copyright/" target="_blank">Privacy Policy</a></p>
	  <div class="clr"></div>
	  </div>
	</footer>
</html>

<?php
define(DOC_ROOT,dirname(__FILE__));
include(DOC_ROOT.'/admin_connection.php');
session_start();
define(ADMIN,$_SESSION['name']);
if($_SESSION['type'] != 'A'){
header("location:admin_login.php");
}

$conn = mysqli_connect($dbHost, $dbUser, $dbPass, $dbName)
or die('Error Connecting to MYSQL Database');

$sql = "SELECT * FROM cap_expend_prop_pending WHERE Form_ID='$key'";
$result = mysqli_query($conn, $sql);
$row = $result->fetch_assoc();

echo "
<div class='data'>
    <div class='row'>
          <div class='triplecolumn'>
            <h1>Date</h1>
            <h2>".$row["Date"]."</h2>
            
            <h1>Student ID Number</h1>
            <h2>".$row["Student_ID"]."</h2>
            
            <h1>Request Type</h1>
            <h2>".$row["Request_Type"]."</h2>
        </div>
        <div class='triplecolumn'>
            <h1>First Name</h1>
            <h2>".$row["First_Name"]."</h2>
            
            <h1>Organization</h1>
            <h2>".$row["Organization"]."</h2>
            
            <h1>Amount Requested</h1>
            <h2>".$row["Amount_Requested"]."</h2>
        </div>
        <div class='triplecolumn'>
            <h1>Last Name</h1>
            <h2>".$row["Last_Name"]."</h2>
            
            <h1>University Email</h1>
            <h2>".$row["Email"]."</h2>
            
            <h1>Request Description</h1>
            <h2>".$row["Request_Comments"]."</h2>
        </div>
    </div>
    <button type='submit' value=".$row["Form_ID"]." name='approve'>Approve</button>
    <button type='submit' value=".$row["Form_ID"]." name='decline'>Decline</button>
</div>   


";



if(isset($_POST["approve"]))
  {
  
    //CREATE A VARIABLE THAT HOLDS THE SELECTED PRODUCTED TO BE ADDED TO CART
    $form_id = $_POST["approve"];
  
    //echo '<p>Form ID = '.$form_id.'</p>';

    //Grabbing info to put into approved database
    $sql2 = "SELECT * FROM cap_expend_prop_pending WHERE Form_ID = '$form_id'";
    $result2 = mysqli_query($conn, $sql2);
    
    $row2 = $result2->fetch_assoc();
    //Variables
    $Student_ID = $row2['Student_ID'];
    $First_Name = $row2['First_Name'];
    $Last_Name = $row2['Last_Name'];
    $Email = $row2["Email"];
		$Request_Comments = $row2["Request_Comments"];
    $Date = $row2['Date'];
    $Amount_Requested = $row2['Amount_Requested'];
    $Organization = $row2['Organization'];
    $Request_Type = $row2['Request_Type'];
    
    //echo '<p>Organization  = '.$Organization.'</p>';
  
    //CREATE A VARIABLE THAT HOLDS THE SELECTED PRODUCTED TO BE ADDED TO CART
    $form_id = $_POST["approve"];
  
    //echo '<p>Form ID = '.$form_id.'</p>';

    //Grabbing info to put into approved database
    $sql2 = ("INSERT INTO cap_expend_prop_approved(Date, First_Name, Last_Name, Student_ID, Organization, Email, Request_Type, Amount_Requested, Request_Comments)
    VALUES('$Date', '$First_Name', '$Last_Name', '$Student_ID', '$Organization', '$Email', '$Request_Type', '$Amount_Requested', '$Request_Comments')");

    if (mysqli_query($conn, $sql2)) {
      echo "<p>Form inserted to approved database successfully</p>";
      
      $sql2 = "DELETE FROM cap_expend_prop_pending WHERE Form_ID = '$form_id'";
      
      if (mysqli_query($conn, $sql2)) { 
        echo "<p>Record deleted successfully</p>";
        //Update Page once it successfully completes query
        echo "<meta http-equiv='refresh' content='0'>";    
      }
      else {  
        echo "<p>Error deleting record: " . mysqli_error($conn)."</p>";
      }
    } 
    else {
      echo "<p>Error inserting form: " . mysqli_error($conn)."</p>";
    }
  }
  
if(isset($_POST["decline"]))
  {
  
    //CREATE A VARIABLE THAT HOLDS THE SELECTED PRODUCTED TO BE ADDED TO CART
      $form_id = $_POST["decline"];
  
    //echo '<p>Form ID = '.$form_id.'</p>';
  
    $sql2 = "DELETE FROM cap_expend_prop_pending WHERE Form_ID = '$form_id'";
    
    if (mysqli_query($conn, $sql2)) {
      echo "<p>Record deleted successfully</p>"; 
      //Update Page once it successfully completes query
        echo "<meta http-equiv='refresh' content='0'>";    
    } 
    else {     
      echo "<p>Error deleting record: " . mysqli_error($conn)."</p>";
    }
  }

$conn->close();
?>
